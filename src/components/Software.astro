---
import softwareList from '~/content/software.json';

// accept either `id` (new) or `software` (legacy) prop names
const { title: propTitle, subtitle: propSubtitle, desc: propDesc, logo: propLogo, url: propUrl, id: propId, software: propSoftware, alt: propAlt } = Astro.props;

let title = propTitle;
let subtitle = propSubtitle;
let desc = propDesc;
let logo = propLogo;
let url = propUrl;

// prefer `id` prop, fall back to legacy `software`
let softwareId = propId || propSoftware;

if (softwareId) {
  const s = softwareList.find((x) => x.id === softwareId);
  if (s) {
    title = title || s.title;
    subtitle = subtitle || s.subtitle;
    desc = desc || s.description;
    logo = logo || s.logo;
    url = url || s.url;
  }
}

// fallback initials for when no logo is available
const initials = (title || '')
  .split(/\s+/)
  .filter(Boolean)
  .slice(0, 2)
  .map((w) => w[0])
  .join('')
  .toUpperCase();

const altText = propAlt || (title ? `${title} logo` : 'logo');

// compute a safe slug for use as an element id so anchors can target it
// prefix with `software-` to avoid collisions and ensure it doesn't start with a digit
const slug = softwareId
  ? `${String(softwareId).toLowerCase().replace(/[^a-z0-9-_:.]/g, '-')}`
  : undefined;

---

<section class="rounded-2xl p-8 md:p-12" id={slug}>
  <div class="max-w-6xl mx-auto flex flex-row items-start gap-6 md:gap-10">    <div class="flex-shrink-0">
      {
        logo ? (
          <a href={url || '#'} class="block">
            <img
              src={logo}
              alt={altText}
              class="w-28 md:w-[14vw] lg:w-[10vw] max-w-[320px] h-auto object-contain rounded-xl"
            />
          </a>
        ) : (
          <div class="w-28 md:w-[14vw] lg:w-[10vw] max-w-[320px] h-auto flex items-center justify-center rounded-xl">
            <span class="font-bold text-2xl">{initials || 'SW'}</span>
          </div>
        )
      }
    </div>

    <div class="flex-1 text-left">
      <h1 class="text-2xl sm:text-3xl md:text-4xl font-extrabold leading-tight mb-2 flex flex-col sm:flex-row sm:justify-between sm:items-baseline">
        <span class="flex-1">
          {url ? (
            <a href={url} class="no-underline text-current">{title}</a>
          ) : (
            <span>{title}</span>
          )}
        </span>
        {subtitle && (
          <span class="mt-2 sm:mt-0 text-lg sm:text-xl md:text-2xl font-semibold sm:ml-4 sm:text-right">{subtitle}</span>
        )}
      </h1>
  {desc && <p class="text-base md:text-lg max-w-3xl mt-2" set:html={desc}></p>}
    </div>
  </div>
</section>
